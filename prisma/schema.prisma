generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------------------------------------------
// MODELS
// -----------------------------------------------------

model service_categories {
  id          BigInt    @id @default(autoincrement())
  uuid        String    @unique @default(uuid())
  name        String    @unique @db.VarChar(100)
  description String?
  created_at  DateTime  @default(now()) @db.Timestamptz
  updated_at  DateTime? @db.Timestamptz

  // Relations
  project_categories project_categories[]
  media              media?               @relation(fields: [media_id], references: [id])
  media_id           BigInt?

  @@index([media_id])
}

model clients {
  id             BigInt    @id @default(autoincrement())
  uuid           String    @unique @default(uuid())
  classification String?   @default("PT") @db.VarChar(120) // PT, CV, Firma, Perorangan, etc.
  name           String    @unique @db.VarChar(150)
  created_at     DateTime  @default(now()) @db.Timestamptz
  updated_at     DateTime? @db.Timestamptz

  // Relations
  projects projects[]
  media    media?     @relation(fields: [media_id], references: [id])
  media_id BigInt?

  @@index([media_id])
}

model projects {
  id          BigInt    @id @default(autoincrement())
  uuid        String    @unique @default(uuid())
  name        String
  slug        String?   @unique @db.VarChar(200)
  location    String?
  description String?
  start_date  DateTime? @db.Date
  end_date    DateTime? @db.Date
  year        Int?
  po_price    BigInt?
  status      String    @default("draft")
  created_at  DateTime  @default(now()) @db.Timestamptz
  updated_at  DateTime? @db.Timestamptz

  // Foreign Key
  clients_id BigInt
  client     clients @relation(fields: [clients_id], references: [id])

  // Relations
  project_images     project_images[]
  project_categories project_categories[]

  @@index([clients_id])
  @@index([status])
  @@index([year])
}

model project_images {
  id         BigInt    @id @default(autoincrement())
  uuid       String    @unique @default(uuid())
  is_cover   Boolean   @default(false)
  caption    String?
  created_at DateTime  @default(now()) @db.Timestamptz
  updated_at DateTime? @db.Timestamptz

  // projects reference
  projects_id BigInt
  project     projects @relation(fields: [projects_id], references: [id])

  // Media reference
  media_id BigInt?
  media    media?  @relation(fields: [media_id], references: [id])

  @@unique([projects_id, media_id])
  @@index([projects_id])
  @@index([media_id])
  @@index([is_cover])
}

model project_categories {
  id         BigInt    @id @default(autoincrement())
  uuid       String    @unique @default(uuid())
  created_at DateTime  @default(now()) @db.Timestamptz
  updated_at DateTime? @db.Timestamptz

  // Foreign Keys
  projects_id           BigInt
  service_categories_id BigInt

  project          projects           @relation(fields: [projects_id], references: [id])
  service_category service_categories @relation(fields: [service_categories_id], references: [id])

  @@unique([projects_id, service_categories_id])
  @@index([projects_id])
  @@index([service_categories_id])
}

model platform_users {
  id   BigInt @id @default(autoincrement())
  uuid String @unique @default(uuid())

  username String @unique @db.VarChar(100)
  password String @db.VarChar(255)

  created_at DateTime  @default(now()) @db.Timestamptz
  updated_at DateTime? @updatedAt @db.Timestamptz

  // Relations
  medias media[]

  @@index([username])
}

model media {
  id         BigInt    @id @default(autoincrement())
  uuid       String    @unique @default(uuid())
  url        String
  mime_type  String
  size_bytes Int // in bytes
  width      Int?
  height     Int?
  duration   Float?
  alt_text   String?
  created_at DateTime  @default(now()) @db.Timestamptz
  updated_at DateTime? @updatedAt @db.Timestamptz

  // Relations
  clients            clients[]
  service_categories service_categories[]
  project_images     project_images[]

  uploader_id BigInt
  uploader    platform_users @relation(fields: [uploader_id], references: [id])

  @@index([uploader_id])
  @@index([mime_type])
  @@index([size_bytes])
}
